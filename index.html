<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Control Horario – Admin / Empleado</title>
  <style>
    :root{
      --bg:#0f172a;       /* slate-900 */
      --card:#111827;     /* gray-900 */
      --muted:#1f2937;    /* gray-800 */
      --accent:#2563eb;   /* blue-600 */
      --good:#16a34a;     /* green-600 */
      --bad:#dc2626;      /* red-600 */
      --warn:#d97706;     /* amber-600 */
      --text:#e5e7eb;     /* gray-200 */
      --textmuted:#94a3b8;/* slate-400 */
      --chip:#334155;     /* slate-700 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,#0b1223,#0f172a);
      color:var(--text); font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif;
    }
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:16px}
    .brand .dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px rgba(37,99,235,.8)}
    .title{font-size:22px;font-weight:700;letter-spacing:.3px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;box-shadow:0 10px 35px rgba(0,0,0,.25)}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    .pad{padding:16px}
    .muted{color:var(--textmuted)}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .sp{justify-content:space-between}
    .btn{
      background:var(--accent); color:white; border:none; border-radius:10px; padding:10px 14px;
      font-weight:600; cursor:pointer; transition:transform .05s ease,opacity .15s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.gray{background:#374151}
    .btn.good{background:var(--good)}
    .btn.bad{background:var(--bad)}
    .btn.warn{background:var(--warn)}
    .btn.small{padding:6px 10px; font-weight:500; border-radius:8px}
    .segmented{background:#0b1223;border:1px solid #1f2937;border-radius:12px;padding:4px;display:inline-flex;gap:4px}
    .segmented button{background:transparent;color:var(--textmuted);padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .segmented button.active{background:var(--accent);color:white}
    input,select,textarea{
      background:#0b1223;border:1px solid #1f2937;color:var(--text);
      padding:10px 12px;border-radius:10px; width:100%;
    }
    label{font-size:12px;color:var(--textmuted);display:block;margin:8px 2px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #1f2937}
    th{color:#93c5fd;text-align:left;background:#0b1223}
    .chip{background:var(--chip);padding:4px 8px;border-radius:999px;font-size:12px}
    .hidden{display:none !important}
    .msg{margin:10px 0;font-size:14px}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi .item{background:#0b1223;border:1px solid #1f2937;border-radius:12px;padding:10px 12px}
    .danger{color:#fecaca}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <div class="dot"></div>
      <div class="title">Control Horario · Panel</div>
      <div class="chip" id="env-chip">Desconectado</div>
      <div class="chip" id="role-chip">–</div>
      <div style="flex:1"></div>
      <div class="muted" id="user-email">—</div>
      <button class="btn small gray" id="logout-btn">Salir</button>
    </div>

    <!-- AUTH -->
    <div id="auth-card" class="card pad">
      <div class="row sp">
        <div><b>Ingresar</b></div>
        <div class="segmented">
          <button id="tab-login" class="active">Login</button>
          <button id="tab-register">Registro</button>
        </div>
      </div>
      <div class="grid grid-2" style="margin-top:10px">
        <div>
          <label>Email</label>
          <input id="email" type="email" placeholder="tu@email.com"/>
        </div>
        <div>
          <label>Contraseña</label>
          <input id="password" type="password" placeholder="••••••••"/>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="login-btn">Entrar</button>
        <button class="btn gray" id="register-btn">Crear cuenta</button>
        <button class="btn warn" id="reset-btn">Blanquear contraseña</button>
        <div class="msg" id="auth-msg"></div>
      </div>
    </div>

    <!-- APP -->
    <div id="app-card" class="card pad hidden">

      <!-- SWITCH VIEW -->
      <div class="row sp" style="margin-bottom:10px">
        <div class="row">
          <div class="chip">Mes: <span id="month-chip"></span></div>
          <div class="chip">Última actualización: <span id="last-update-chip">—</span></div>
          <div class="chip">Bloqueo: <span id="lock-chip">—</span></div>
        </div>
        <div class="segmented">
          <button id="seg-employee" class="active">Empleado</button>
          <button id="seg-admin">Admin</button>
        </div>
      </div>

      <!-- EMPLOYEE VIEW -->
      <div id="employee-view">
        <div class="grid grid-3">
          <div class="kpi item">
            <div class="item"><div class="muted">Empleado</div><div id="emp-name" style="font-weight:700">—</div></div>
            <div class="item"><div class="muted">Horario habitual</div><div id="emp-sched">—</div></div>
          </div>
          <div></div><div></div>
        </div>

        <div class="row" style="margin:12px 0">
          <button class="btn good" id="btn-submit-month">Enviar Planilla</button>
          <button class="btn gray" id="btn-extra-day">Reportar Día Extra</button>
          <div class="msg" id="emp-msg"></div>
        </div>

        <div id="extra-form" class="card pad hidden" style="margin-bottom:12px">
          <div class="row sp"><b>Nuevo reporte puntual</b><button class="btn small gray" id="close-extra">Cerrar</button></div>
          <div class="grid grid-3" style="margin-top:8px">
            <div><label>Fecha</label><input type="date" id="extra-date"></div>
            <div><label>Horario trabajado</label><input id="extra-hours" placeholder="9:00 a 18:00"></div>
            <div><label>Comentarios</label><input id="extra-notes" placeholder="Guardia, reemplazo, etc."></div>
          </div>
          <div class="row" style="margin-top:8px"><button class="btn" id="save-extra">Guardar</button><div class="msg" id="extra-msg"></div></div>
        </div>

        <div class="card">
          <div class="pad row sp"><b>Reporte mensual</b><div class="muted">Haz clic para marcar cada día</div></div>
          <div class="pad" style="padding-top:0">
            <table>
              <thead>
                <tr><th>Día</th><th>Horario habitual</th><th>Estado / Acción</th></tr>
              </thead>
              <tbody id="tbl-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADMIN VIEW -->
      <div id="admin-view" class="hidden">
        <div class="grid grid-2">
          <div class="card pad">
            <b>Gestión de empleados</b>
            <div class="grid grid-3" style="margin-top:10px">
              <div><label>Email</label><input id="adm-email" placeholder="empleado@ejemplo.com"></div>
              <div><label>Nombre</label><input id="adm-name" placeholder="Nombre y Apellido"></div>
              <div><label>Horario habitual</label><input id="adm-sched" placeholder="L-V 9-18"></div>
            </div>
            <div class="row" style="margin-top:10px">
              <button class="btn" id="adm-upsert">Crear/Actualizar</button>
              <button class="btn warn" id="adm-reset">Blanquear contraseña</button>
              <div class="msg" id="adm-msg"></div>
            </div>
          </div>
          <div class="card pad">
            <b>Bloqueo mensual</b>
            <div class="grid grid-3" style="margin-top:8px">
              <div><label>UID empleado</label><input id="adm-lock-uid" placeholder="uid..."></div>
              <div><label>Mes (YYYY-MM)</label><input id="adm-lock-month" placeholder="2025-10"></div>
              <div class="row" style="align-items:end">
                <button class="btn bad" id="adm-unlock">Permitir cambios</button>
                <button class="btn good" id="adm-lock">Bloquear</button>
              </div>
            </div>
            <div class="msg" id="lock-msg"></div>
          </div>
        </div>

        <div class="card pad" style="margin-top:12px">
          <div class="row sp">
            <b>Listado de empleados</b>
            <button class="btn gray" id="export-csv">Exportar CSV</button>
          </div>
          <div class="pad" style="padding-top:0">
            <table>
              <thead><tr><th>Nombre</th><th>Email</th><th>Horario</th><th>UID</th><th>Acciones</th></tr></thead>
              <tbody id="adm-list"></tbody>
            </table>
            <div class="msg" id="adm-list-msg"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="app.js"></script>
</body>
</html>
