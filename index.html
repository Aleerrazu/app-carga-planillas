<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Horas Mensuales</title>
    
    <!-- Incluye los SDKs de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        /* Estilos Mobile-First y Responsive */
        body { 
            font-family: Arial, sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start;
            min-height: 100vh; 
            background-color: #f4f4f4; 
            margin: 0; 
            padding: 20px 10px;
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); 
            width: 100%;
            max-width: 800px; /* M√°s ancho para la tabla de empleados */
            text-align: center; 
            box-sizing: border-box; 
        }
        
        /* Estilos generales de elementos */
        input, select, textarea, button { 
            width: 100%; 
            padding: 10px; 
            margin: 8px 0; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box; 
            font-size: 1em;
        }
        button { 
            color: white; 
            border: none; 
            cursor: pointer; 
            background-color: #5cb85c; 
            font-weight: bold;
        }
        button:hover { 
            opacity: 0.9; 
        }
        .hidden { 
            display: none; 
        }
        .card { 
            border: 1px solid #ddd; 
            padding: 15px; 
            border-radius: 6px; 
            text-align: left; 
            margin-bottom: 20px;
        }
        .info-box {
            background-color: #e3f2fd; 
            color: #1a237e; 
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Estilos para la tabla de reporte mensual (empleado) */
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }
        .report-table th, .report-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .report-table th {
            background-color: #e9ecef;
        }
        .action-button {
            width: auto;
            padding: 5px 8px;
            margin: 2px;
            font-size: 1.1em;
            border-radius: 50%;
            line-height: 1;
        }
        .btn-check { background-color: #28a745; } /* Verde */
        .btn-cross { background-color: #dc3545; } /* Rojo */
        .btn-plus { background-color: #007bff; }  /* Azul */

        .extra-input-row td {
            background-color: #f1f8ff;
            padding: 5px;
        }
        .extra-input-row input, .extra-input-row textarea {
            width: calc(100% - 16px);
            margin: 5px 0;
            padding: 5px;
            font-size: 0.9em;
        }

        /* Estilos para el √°rea de administraci√≥n */
        #admin-view {
            margin-top: 30px;
            border-top: 2px dashed #ccc;
            padding-top: 20px;
        }
        #employee-list-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }
        #employee-list-table th, #employee-list-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        #export-button, #admin-button-new-employee {
             width: auto;
             padding: 10px 15px;
             margin-right: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- VISTA DE AUTENTICACI√ìN (LOGIN/REGISTRO) -->
    <div id="auth-view">
        <h2>Reporte de Horas</h2>
        <p id="message" style="color: red;"></p>

        <!-- Formularios de Auth -->
        <div id="register-form">
            <h3>Registrarse</h3>
            <p>Necesario para que el Administrador asigne tu horario.</p>
            <input type="email" id="reg-email" placeholder="Correo Electr√≥nico" required>
            <input type="password" id="reg-password" placeholder="Contrase√±a (m√≠n. 6 caracteres)" required>
            <button onclick="registerUser()">Registrar</button>
            <p>¬øYa tienes cuenta? <a href="#" onclick="showLogin()">Inicia Sesi√≥n</a></p>
        </div>
        <div id="login-form" class="hidden">
            <h3>Iniciar Sesi√≥n</h3>
            <input type="email" id="log-email" placeholder="Correo Electr√≥nico" required>
            <input type="password" id="log-password" placeholder="Contrase√±a" required>
            <button onclick="loginUser()">Entrar</button>
            <p>¬øNo tienes cuenta? <a href="#" onclick="showRegister()">Reg√≠strate</a></p>
        </div>
    </div>

    <!-- VISTA PRIVADA (DIVIDIDA ENTRE EMPLEADO Y ADMIN) -->
    <div id="private-view" class="hidden">
        <h2>Panel de Reporte Mensual</h2>
        <p>Bienvenido/a: <strong id="employee-name">...</strong> (<span id="user-email-display"></span>)</p>

        <!-- 1. VISTA DE EMPLEADO (Reporte Mensual) -->
        <div id="employee-dashboard">
            <!-- √Årea de Referencia de Horario -->
            <div class="info-box">
                Tu horario habitual: <span id="horario-habitual-display">Cargando...</span> | Mes: <strong id="current-month-display"></strong>
            </div>

            <!-- Bot√≥n para d√≠as fuera del horario habitual (Extras) -->
            <button onclick="showExtraDayForm()" style="background-color: #007bff; margin-bottom: 20px;">
                ‚ûï Reportar D√≠a Extra (Fin de semana, festivo, etc.)
            </button>

            <!-- Card para d√≠as Extra a reportar -->
            <div class="card hidden" id="extra-day-form">
                <h3>Reportar D√≠a Extra</h3>
                <input type="date" id="extra-report-date" required>
                <input type="text" id="extra-horario-reportado" placeholder="Horario trabajado (Ej: 9:00 a 14:00)">
                <textarea id="extra-comentarios" placeholder="Motivo del d√≠a extra"></textarea>
                <button onclick="saveExtraDayTimeSheet()" style="background-color: #ffc107; color: black;">Guardar D√≠a Extra</button>
            </div>

            <!-- Tabla Din√°mica del Mes -->
            <div class="card">
                <h3>Jornadas del Mes</h3>
                <p id="loading-report-msg">Generando calendario...</p>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>D√≠a</th>
                            <th>Horario Hab.</th>
                            <th>Reporte</th>
                        </tr>
                    </thead>
                    <tbody id="timesheet-body">
                        <!-- Se llena con JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>


        <!-- 2. VISTA DE ADMINISTRACI√ìN (Gesti√≥n) -->
        <div id="admin-view" class="hidden">
            <h3>üõ†Ô∏è √Årea de Administraci√≥n</h3>
            <p>Gesti√≥n de empleados, reportes y descarga de datos.</p>

            <!-- Acciones de Admin -->
            <div class="card">
                <button onclick="showEmployeeManagement()" style="background-color: #6f42c1;" id="admin-button-manage-employees">
                    üë§ Gestionar Empleados
                </button>
                <button onclick="exportToCsv()" id="export-button" style="background-color: #007bff;">
                    ‚¨áÔ∏è Descargar Todos los Reportes (CSV/Excel)
                </button>
            </div>

            <!-- Subvista de Gesti√≥n de Empleados -->
            <div class="card hidden" id="employee-management-view">
                <h3>Gesti√≥n de Usuarios</h3>

                <!-- Formulario para Nuevo Empleado / Blanqueo -->
                <div class="card">
                    <h4>‚ûï Crear/Blanquear Contrase√±a</h4>
                    <input type="email" id="admin-employee-email" placeholder="Correo del empleado (para buscar o crear)" required>
                    <input type="text" id="admin-employee-name" placeholder="Nombre completo (solo para nuevos empleados)">
                    <input type="text" id="admin-employee-schedule" placeholder="Horario habitual (Ej: L-V 9:00 a 18:00)">
                    <button onclick="adminCreateOrUpdateEmployee()" style="background-color: #28a745; margin-right: 5px;">Crear/Actualizar Empleado</button>
                    <button onclick="adminResetPassword()" style="background-color: #ffc107; color: black;">Blanquear Contrase√±a</button>
                    <p id="admin-action-message" style="margin-top: 10px;"></p>
                </div>


                <!-- Tabla de Empleados Registrados -->
                <h4>Listado de Empleados</h4>
                <p id="loading-employees-msg">Cargando listado...</p>
                <table id="employee-list-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Horario</th>
                            <th>Ver Reportes</th>
                        </tr>
                    </thead>
                    <tbody id="employee-list-body">
                        <!-- Llenado con JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <button onclick="logoutUser()" style="background-color: #d9534f; margin-top: 10px;">Cerrar Sesi√≥n</button>
    </div>
</div>

<!-- Enlace al archivo de l√≥gica -->
<script src="app.js"></script>

</body>
</html>


